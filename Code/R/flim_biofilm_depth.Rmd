---
title: "flim_biofilm"
output: html_document
---
```{r packages}
require(dplyr)
require(ggplot2)
require(gridExtra)
require(grid)
require(extrafont)
require(ggforce)
require(scales)
library(RColorBrewer)
library(data.table)
library(fasano.franceschini.test)

```


```{r colors and shapes}

circleFun <- function(center = c(0.5,0),diameter = 1 , npoints = 100){
    r = diameter / 2
    tt <- seq(0,2*pi,length.out = npoints)
    xx <- center[1] + r * cos(tt)
    yy <- center[2] + r * sin(tt)
    return(data.frame(x = xx, y = yy))
}

circle1<- circleFun()


color_map_1<-c(
  "Enzyme-bound NADH"="#0072b2",
  "MDH NADH"= "#0072b2", 
  "Free NADH"= "#e69f00",
   "PVD"="#d55e00",
  "PYO"="#56b4e9", 
  "PYO (Reduced)" = "#56b4e9",
  "OHPhz (Reduced)" = "#009e73", 
  "FAD" = "#EE9B00" , 
   "CPX" = "#9B2226" ,
  "OLS" = "black" , 
  "PVD + Fe" = "#f0e442" )

color_map_2<-c(
  "Enzyme-bound NADH"="#272727",
  "MDH NADH"="#272727",
  "Free NADH"="#696773",
   "PVD"="#FED766",
  "PYO"="#009FB7")

#EFF1F3

shape_maps<-c(
  "Enzyme-bound NADH"=22,
  "MDH NADH"=22,
  "Free NADH"=23,
   "PVD"=24,
  "PYO"=25 , 
  "PYO (Reduced)" = 25 , 
  "OHPhz (Reduced)" = 21,
  "FAD" = 21 , 
  "CPX" = 22 ,
  "OLS" = 22)


# media color maps
media_colors <- c(
  "ASM" = "#444444", 
  "M9 suc" = "#D3B2D9" ,
  "M9 suc+sup" = "#FF7700" )

media_shapes <- c(
  "ASM" = 21 , 
  "M9 suc" = 22  ,
  "M9 suc+sup" = 23 )

color_shape_maps<-c(
  "Enzyme-bound NADH"= 0,
  "MDH NADH"= 0,
  "Free NADH"=5,
   "PVD"= 2 ,
  "PYO"= 6 )

# gradient color map
yellow_blue_1 <- c('#EDF8B1',  '#C7E9B4' , "#41B6C4" , "#225EA8" , "#081D58" )
yellow_blue <- c('#EDF8B1',  '#C7E9B4' , "#41B6C4" , "#225EA8"  )
yellow_red <- c("#ffba08", "#f48c06",  "#dc2f02", "#9d0208") 
green_red_1 <- c("#90BE6D" , "#F9C74F", "#F8961E", "#F3722C" ,  "#F94144")
green_red <- c("#90BE6D" , "#F9C74F",  "#F94144")
blue_yellow_orange <- c("#3BCFD4", "#D7FC05", "#EC6E20")
purple_green <- c('#7C65A9' ,"#96D4CA") 
blue_green_orange <- c("#0088FF" ,"#5BCA7A" ,  "#FF6200")
white_black <- c("#F8F8FF", "#CAC9CD" ,  "#9B9A9C" , "#6D6A6A" , "#3E3B39" , "#100C07" )

```

```{r references}

ref <- read.csv( file = "/Users/sltg/Documents/GitHub/PseudomonasFLIM/Data/Processed/ref_flim_means.csv")

```


```{r lifetime phasor }

phasorFun <- function(omega,time){
  #convert megaheartz to nanoseconds
  NS =omega*2*pi/1000
  g=1/(1+(NS*time)^2)
  s=NS*time/(1+(NS*time)^2)
 return(data.frame(mean_g1=g, mean_s1=s, lifetime=time))
}


enzymeNADH<-phasorFun(80,3.2)
phasorFun(80,10)
enzymeNADH$object<-c("Enzyme-bound NADH")

oxlipid<-phasorFun(80,7.8)

oxlipid$object<-c("OLS")

ref <- rbind(ref, enzymeNADH)
ref <- rbind(ref, oxlipid)

```


```{r biofilm flim data}
# g and s data
biofilm <- read.csv(file =  '/Users/sltg/Documents/GitHub/PseudomonasFLIM/Data/Processed/df_biofilm_flim.csv', header=T)

# get depth from filename
biofilm$depth <- gsub(pattern = ".*[0-9]p_", replacement="", x= biofilm$FileName )
biofilm$depth <- gsub(pattern = "CG0T.*" , replacement = "", x=biofilm$depth)
biofilm$depth <- gsub(pattern = "d.*" , replacement = "", x=biofilm$depth)

# get strain (wt vs phz ko)
biofilm$strain <- ifelse( grepl(x=biofilm$condition, pattern="WT"), "WT", "Î”phz") 

# get media (asm or m9 succinate)
biofilm$media <- ifelse( grepl(x=biofilm$condition, pattern="ASM"), "ASM", "M9 suc") 



biofilm <- subset(biofilm, FileName!="/Users/sltg/Documents/GitHub/PseudomonasFLIM/Data/FLIM/biofilm/phzko_ASM/plate1/45p_75d000$CG0T_0-1__ch1_h1_h2.R64")

```

```{r plot phasor}

ggplot() + 
  geom_path(data=subset(circle1, y>0),aes(x=x,y=y))+
  geom_bin2d(data = biofilm, aes(x=g1, y=s1 ), bins=150)+
  facet_grid(.~strain + media )



g1_density <- ggplot() + geom_density(data = biofilm, aes(x = g1, color = depth)) + 
  facet_grid(.~strain + media )

s1_density <- ggplot() + geom_density(data = biofilm, aes(x = s1, color = depth)) + 
  facet_grid(.~strain + media )



+
  scale_color_manual( values = media_colors )+
  scale_fill_manual(values = media_colors ) +
   theme( plot.background = element_rect(fill="white", color="white"),
        panel.background = element_rect(fill="white", color="black"),
        panel.grid = element_blank(), 
        axis.text=element_text(color="black",size=12),
        axis.ticks=element_blank(),
        axis.title.y = element_text(color="black", size=12),
      axis.title.x= element_blank(),
        strip.background = element_rect(color="black", fill="white"),
        strip.text =element_text(color="black", size=12),
                               legend.text=element_text(size=12),
     strip.text.y=element_text(angle=0),
     strip.text.x=element_text(angle=0),
   plot.title = element_text(hjust = 0.5, size=12),
        legend.title=element_blank() ,
   legend.position = 'none')+
  scale_x_continuous(position="top", breaks=pretty_breaks(n=3), limits = c(0,1))+
  ylab("Density")




```
